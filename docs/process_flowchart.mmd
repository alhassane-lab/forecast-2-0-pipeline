flowchart TD
    subgraph RUNTIME[Execution pipeline AWS-only]
        A([Debut pipeline]) --> B[Airbyte Sync JSON/Excel -> S3 Raw]
        B --> C{Fichiers S3 disponibles ?}
        C -- Non --> Z[Log erreur + arret]
        C -- Oui --> D[Extraction InfoClimat + Wunderground]
        D --> E[Transformation schema MongoDB]
        E --> F[Validation]
        F --> G{Enregistrement valide ?}
        G -- Non --> H[Compter rejet + journaliser]
        G -- Oui --> I[Ajouter au lot valide]
        H --> J{Fin des enregistrements ?}
        I --> J
        J -- Non --> G
        J -- Oui --> K[Enregistrer lot valide dans S3 processed]
        K --> L[Charger MongoDB ECS insert/upsert]
        L --> M[Generer quality report + status pipeline]
        M --> N([Fin pipeline])
    end

    subgraph PLATFORM[Industrialisation AWS]
        P1[Build images Docker pipeline + MongoDB RS] --> P2[Push images ECR]
        P2 --> P3[Deploy Terraform ECS MongoDB + ECS pipeline]
        P3 --> P4[Replica set MongoDB ECS: mongo-1 mongo-2 mongo-3]
        P3 --> P5[Scheduler EventBridge -> tache ECS pipeline]
    end

    P5 --> A
    P4 --> L
